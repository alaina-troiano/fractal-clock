<html>
<head>
<meta charset="utf-8"/>
<title>Fractal Clock</title>
<style>
canvas {
  border: 1px solid #888;
}
</style>
</head>
<body>

  <canvas width="600px" height="600px" id="canvas"></canvas>
  <hr>
  <h2>Settings</h2>
  Fractal color: <select id="fractalColor">
    <option style="color: white; background-color: rgba(160, 0, 0, 1)" value="rgba(160, 0, 0, 0.2)">Red</option>
    <option style="color: white; background-color: rgba(220, 120, 0, 1)" value="rgba(220, 120, 0, 0.2)">Orange</option>
    <option style="color: white; background-color: rgba(0, 120, 0, 1)" value="rgba(0, 120, 0, 0.2)">Green</option>
    <option style="color: white; background-color: rgba(0, 0, 160, 1)" value="rgba(0, 0, 160, 0.2)">Blue</option>
    <option style="color: white; background-color: rgba(100, 0, 120, 1)" value="rgba(100, 0, 120, 0.2)">Purple</option>
  </select>
  <br>
  Background color: <select id="backgroundColor">
    <option style="color: black; background-color: white;" value="white">White</option>
    <option style="color: white; background-color: black;" value="black">Black</option>
  </select>
  <hr>
  <p>inspired by <a href="https://www.youtube.com/watch?v=4SH_-YhN15A">a CodeParade video</a></p>
  <p>TODO</p>
  <ul>
    <li>clock class</li>
    <li>clock numbers and ticks</li>
    <li>canvas size selector</li>
    <li>suggested music</li>
    <li>make it a timer</li>
    <li>improve performance as needed</li>
  </ul>


  <script>
  // https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D

  var handLength = 100;
  var factor = 0.7;
  var minLength = 3;
  var canvasSize = 600;

  function Vector2D(x, y){
    this.x = x;
    this.y = y;
  }

  function drawCircle(center, radius){
    var ctx = document.getElementById('canvas').getContext('2d');
    ctx.beginPath();
    ctx.arc(center.x, center.y, radius, 0, 2*Math.PI);
    ctx.stroke(); 
  }

  function drawLine(start, end) {
    var ctx = document.getElementById('canvas').getContext('2d');
    ctx.beginPath();
    ctx.moveTo(start.x, start.y);
    ctx.lineTo(end.x, end.y);
    ctx.closePath();
    ctx.stroke();
  }

  function convertAngle(clockAngle) {
    return clockAngle + Math.PI / 2;
  }

  function drawHand(angle, length, start) {
    if (!length) {
     length = handLength;
     start = new Vector2D(canvasSize/2, canvasSize/2);
    }
    var end = new Vector2D(length*Math.sin(angle) + start.x, length*-1*Math.cos(angle) + start.y);
    drawLine(start, end);
    return end;
  }

  function drawFractal(length, minutesAngle, secondsAngle, dm, ds, start){
    while (minutesAngle > Math.PI*2) {
      minutesAngle -= Math.PI*2;
    }
    while (secondsAngle > Math.PI*2) { 
      secondsAngle -= Math.PI*2;
    }
    var newXYm = drawHand(minutesAngle, length, start);
    var newXYs = drawHand(secondsAngle, length, start);
    if (length < minLength) {
      return;
    }
    drawFractal(length*factor, minutesAngle+dm, secondsAngle+dm, dm, ds, newXYm);
    drawFractal(length*factor, minutesAngle+ds, secondsAngle+ds, dm, ds, newXYs);
  }

  function paint(){
    var ctx = document.getElementById('canvas').getContext('2d');
    ctx.clearRect(0, 0, canvasSize, canvasSize);
    ctx.font = "20px serif";
    
    var backgroundColor = document.getElementById("backgroundColor").value;
    if (backgroundColor === "black") {
      ctx.strokeStyle = "white";
    } else {
      ctx.strokeStyle = "black";
    }

    drawCircle(new Vector2D(canvasSize/2, canvasSize/2), 125);

    var dt = new Date();
    var minutes = dt.getMinutes();
    var seconds = dt.getSeconds();
    var paddedSeconds = ("0"+seconds).slice(-2);
    ctx.fillText("" + minutes + ":" + paddedSeconds + "", 20, 20);
    var fractionalSeconds = dt.getMilliseconds() / 1000;
    seconds += fractionalSeconds;
    var fractionalMinutes = seconds / 60;
    minutes += fractionalMinutes;
    var minutesAngle = (minutes/60)*2*Math.PI;
    var secondsAngle = (seconds/60)*2*Math.PI;

    drawHand(minutesAngle);
    drawHand(secondsAngle);
    ctx.strokeStyle = document.getElementById("fractalColor").value;
    drawFractal(
      handLength*factor,
      minutesAngle+secondsAngle,
      secondsAngle*2,
      minutesAngle, secondsAngle,
      new Vector2D(handLength*Math.sin(minutesAngle)+canvasSize/2,
      handLength*-1*Math.cos(minutesAngle)+canvasSize/2),
    );
    drawFractal(
      handLength*factor, 
      minutesAngle+secondsAngle, 
      secondsAngle*2, 
      minutesAngle, secondsAngle, 
      new Vector2D(handLength*Math.sin(secondsAngle)+canvasSize/2, 
      handLength*-1*Math.cos(secondsAngle)+canvasSize/2),
    );

    window.requestAnimationFrame(paint);
  }

  function init(){
    window.requestAnimationFrame(paint);
  }
  
  document.getElementById("backgroundColor").addEventListener('change', function(){ 
    document.getElementsByTagName("body")[0].style.background = this.value;
  });

  init();
</script>
</body>
</html>
